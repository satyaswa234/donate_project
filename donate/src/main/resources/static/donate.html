<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Donation Management</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="https://www.svgrepo.com/show/353685/sprout.svg">

    <style>
        body {
          background-color: #f8f9fa;
          font-family: 'Inter', sans-serif;
        }

        .navbar {
          background-color: #0d6efd;
        }
        .navbar-brand {
          color: #fff !important;
          font-weight: 600;
        }

        .carousel-item img {
          height: 400px;
          object-fit: cover;
          border-radius: 10px;
        }

        .section-title {
          margin-top: 40px;
          margin-bottom: 20px;
          font-weight: 600;
        }

        .card {
          border-radius: 15px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.08);
          border: none;
        }

        .toast-container {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 2000;
        }

        .donation-line {
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-wrap: wrap;
          font-size: 14px;
        }

        .donation-line span {
          margin-right: 10px;
          white-space: nowrap;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="#">üå± Donate System</a>
    </div>
</nav>

<!-- Carousel Section -->
<div id="donationCarousel" class="carousel slide container mt-4" data-bs-ride="carousel">
    <div class="carousel-inner">

        <!-- Slide 1: Books -->
        <div class="carousel-item active">
            <img src="https://images.unsplash.com/photo-1516979187457-637abb4f9353?auto=format&fit=crop&w=1600&q=80" class="d-block w-100" alt="Books Donation">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h5>Donate Books</h5>
                <p>Share knowledge and inspire others through your old books.</p>
            </div>
        </div>

        <!-- Slide 2: Clothes -->
        <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1581579189456-0e1608d85e57?auto=format&fit=crop&w=1600&q=80" class="d-block w-100" alt="Clothes Donation">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h5>Donate Clothes</h5>
                <p>Help those in need by giving gently used clothes.</p>
            </div>
        </div>

        <!-- Slide 3: Food -->
        <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1604908177527-7e3eec0b34f2?auto=format&fit=crop&w=1600&q=80" class="d-block w-100" alt="Food Donation">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h5>Donate Food</h5>
                <p>Support local communities by donating non-perishable food items.</p>
            </div>
        </div>

    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#donationCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#donationCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>

<!-- Add Donation Section -->
<div class="container pb-5">
    <h2 class="section-title">üì¶ Add Donation</h2>
    <div class="card p-4 mb-5">
        <form id="donationForm">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label" data-bs-toggle="popover" data-bs-title="User ID" data-bs-content="Enter your unique user ID.">User ID ‚ÑπÔ∏è</label>
                    <input type="number" id="userId" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label" data-bs-toggle="popover" data-bs-title="Item Name" data-bs-content="Name of the item you want to donate.">Item Name ‚ÑπÔ∏è</label>
                    <input type="text" id="itemName" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label" data-bs-toggle="popover" data-bs-title="Quantity" data-bs-content="Number of items you're donating.">Quantity ‚ÑπÔ∏è</label>
                    <input type="number" id="quantity" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Item Type</label>
                    <input type="text" id="itemType" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Item Condition</label>
                    <input type="text" id="itemCondition" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Pickup Address</label>
                    <input type="text" id="pickupAddress" class="form-control" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-4" data-bs-toggle="popover" data-bs-title="Submit" data-bs-content="Click to add your donation">Add Donation</button>
        </form>
    </div>

    <!-- Request Donation Section -->
    <h2 class="section-title">ü§ù Make Donation Request</h2>
    <div class="card p-4 mb-5">
        <form id="requestForm">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Donation ID</label>
                    <input type="number" id="requestDonationId" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Receiver User ID</label>
                    <input type="number" id="receiverUserId" class="form-control" required>
                </div>
            </div>
            <button type="submit" class="btn btn-success mt-4" data-bs-toggle="popover" data-bs-title="Request" data-bs-content="Submit your donation request here">Submit Request</button>
        </form>
    </div>

    <!-- All Donations Section -->
    <h2 class="section-title">üìã All Donations</h2>
    <ul class="list-group" id="donationsList"></ul>

    <!-- All Donation Requests Section -->
    <h2 class="section-title">üìã All Donation Requests</h2>
    <ul class="list-group" id="requestsList"></ul>

</div>

<!-- Toast Container -->
<div class="toast-container"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const BASE_URL = 'http://localhost:8080/api/donate';

    // Activate popovers
    const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    popoverTriggerList.map(el => new bootstrap.Popover(el));

    // Toast
    function showToast(msg, type = 'success') {
      const container = document.querySelector('.toast-container');
      const toast = document.createElement('div');
      toast.className = `toast text-bg-${type} border-0 show mb-2`;
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${msg}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      `;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    // Fetch All Donations
    async function loadDonations() {
      const list = document.getElementById('donationsList');
      list.innerHTML = '<li class="list-group-item text-center">Loading...</li>';
      try {
        const res = await fetch(`${BASE_URL}/items`);
        const data = await res.json();
        list.innerHTML = '';
        data.forEach(donation => {
          const item = document.createElement('li');
          item.className = 'list-group-item donation-line';
          item.innerHTML = `
            <span><strong>ID:</strong> ${donation.donationId}</span>
            <span><strong>User:</strong> ${donation.userId}</span>
            <span><strong>Item:</strong> ${donation.itemName}</span>
            <span><strong>Qty:</strong> ${donation.quantity}</span>
            <span><strong>Type:</strong> ${donation.itemType}</span>
            <span><strong>Condition:</strong> ${donation.itemCondition}</span>
            <span><strong>Pickup:</strong> ${donation.pickupAddress}</span>
          `;
          list.appendChild(item);
        });
        if (data.length === 0) {
          list.innerHTML = '<li class="list-group-item text-center text-muted">No donations yet</li>';
        }
      } catch (err) {
        list.innerHTML = '<li class="list-group-item text-danger text-center">Failed to load donations ‚ùå</li>';
      }
    }

    // Fetch All Donation Requests
    async function loadRequests() {
      const list = document.getElementById('requestsList');
      list.innerHTML = '<li class="list-group-item text-center">Loading...</li>';
      try {
        const donationsRes = await fetch(`${BASE_URL}/items`);
        const donations = await donationsRes.json();
        let requests = [];

        for (const donation of donations) {
          const res = await fetch(`${BASE_URL}/requests/${donation.donationId}`);
          const donationRequests = await res.json();
          requests.push(...donationRequests);
        }

        list.innerHTML = '';
        if (requests.length === 0) {
          list.innerHTML = '<li class="list-group-item text-center text-muted">No requests yet</li>';
          return;
        }

        requests.forEach(req => {
          const item = document.createElement('li');
          item.className = 'list-group-item donation-line';
          item.innerHTML = `
            <span><strong>Request ID:</strong> ${req.requestId}</span>
            <span><strong>Donation ID:</strong> ${req.donationId}</span>
            <span><strong>Receiver ID:</strong> ${req.receiverUserId}</span>
            <span><strong>Status:</strong> ${req.status}</span>
          `;
          list.appendChild(item);
        });
      } catch (err) {
        list.innerHTML = '<li class="list-group-item text-danger text-center">Failed to load requests ‚ùå</li>';
      }
    }

    // Add Donation
    document.getElementById('donationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        userId: Number(document.getElementById('userId').value),
        itemName: document.getElementById('itemName').value,
        quantity: Number(document.getElementById('quantity').value),
        itemType: document.getElementById('itemType').value,
        itemCondition: document.getElementById('itemCondition').value,
        pickupAddress: document.getElementById('pickupAddress').value
      };
      const res = await fetch(`${BASE_URL}/item`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      if (res.ok) {
        showToast('Donation added successfully ‚úÖ');
        e.target.reset();
        loadDonations();
      } else {
        showToast('Failed to add donation ‚ùå', 'danger');
      }
    });

    // Submit Donation Request
    document.getElementById('requestForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        donationId: Number(document.getElementById('requestDonationId').value),
        receiverUserId: Number(document.getElementById('receiverUserId').value)
      };
      const res = await fetch(`${BASE_URL}/request`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      if (res.ok) {
        showToast('Request submitted successfully ‚úÖ');
        e.target.reset();
        loadRequests();
      } else {
        showToast('Failed to submit request ‚ùå', 'danger');
      }
    });

    // Initial load
    loadDonations();
    loadRequests();
</script>
</body>
</html>
